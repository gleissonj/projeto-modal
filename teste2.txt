import { ComponentFixture, TestBed } from '@angular/core/testing';
import { Subject } from 'rxjs';
import { MyComponent } from './my-component.component'; // Adjust path as necessary
import { InteractionStatus } from '@azure/msal-browser';

describe('MyComponent', () => {
  let component: MyComponent;
  let fixture: ComponentFixture<MyComponent>;
  let broadcastServiceMock: any;

  beforeEach(async () => {
    // Mock the broadcastService and its inProgress$ observable
    broadcastServiceMock = {
      inProgress$: new Subject<InteractionStatus>()
    };

    await TestBed.configureTestingModule({
      declarations: [MyComponent],
      providers: [
        { provide: 'BroadcastService', useValue: broadcastServiceMock },
      ]
    }).compileComponents();

    fixture = TestBed.createComponent(MyComponent);
    component = fixture.componentInstance;

    // fixture.detectChanges(); is not needed until component rendering

    // Access and use the private _destroying$ directly in the test
    (component as any)._destroying$ = new Subject<void>();
  });

  afterEach(() => {
    // Complete the private _destroying$ subject to clean up
    (component as any)._destroying$.next();
    (component as any)._destroying$.complete();
  });

  it('should call setLoginDisplay when InteractionStatus is None', () => {
    // Spy on the setLoginDisplay method
    const setLoginDisplaySpy = jest.spyOn(component, 'setLoginDisplay');

    // Emit the InteractionStatus.None value
    broadcastServiceMock.inProgress$.next(InteractionStatus.None);

    // Assert that setLoginDisplay is called
    expect(setLoginDisplaySpy).toHaveBeenCalled();
  });

  it('should not call setLoginDisplay when InteractionStatus is not None', () => {
    // Spy on the setLoginDisplay method
    const setLoginDisplaySpy = jest.spyOn(component, 'setLoginDisplay');

    // Emit a different InteractionStatus (e.g., InteractionStatus.Login)
    broadcastServiceMock.inProgress$.next(InteractionStatus.Login);

    // Assert that setLoginDisplay is not called
    expect(setLoginDisplaySpy).not.toHaveBeenCalled();
  });
});
