import { Component } from '@angular/core';
import { S3Service } from './s3.service';

@Component({
  selector: 'app-download',
  templateUrl: './download.component.html',
  styleUrls: ['./download.component.css']
})
export class DownloadComponent {
  bucketName: string = 'seu-bucket'; // Substitua com o nome do seu bucket
  files: string[] = [];

  constructor(private s3Service: S3Service) {}

  ngOnInit() {
    // Quando o componente for carregado, lista os arquivos no bucket
    this.loadFiles();
  }

  // Carrega a lista de arquivos do bucket
  loadFiles() {
    this.s3Service.listFiles(this.bucketName).subscribe(
      (files) => {
        this.files = files;
      },
      (error) => {
        console.error('Erro ao listar arquivos', error);
      }
    );
  }

  // Baixa o arquivo selecionado
  download(fileName: string) {
    this.s3Service.downloadFile(this.bucketName, fileName).subscribe(
      (response) => {
        // Cria um link de download usando a URL temporÃ¡ria fornecida pelo backend
        const link = document.createElement('a');
        link.href = response.url;
        link.download = fileName;
        link.click();
      },
      (error) => {
        console.error('Erro ao baixar arquivo', error);
      }
    );
  }

  // Baixar todos os arquivos
  downloadAll() {
    // Itera sobre a lista de arquivos e baixa cada um
    this.files.forEach(fileName => {
      this.s3Service.downloadFile(this.bucketName, fileName).subscribe(
        (response) => {
          const link = document.createElement('a');
          link.href = response.url;
          link.download = fileName;
          link.click();
        },
        (error) => {
          console.error(`Erro ao baixar o arquivo ${fileName}`, error);
        }
      );
    });
  }
}
