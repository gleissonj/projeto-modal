import io.opentracing.Span;
import io.opentracing.util.GlobalTracer;

public class ServiceExceptionAspect {

    public static void adicionarObjetoLog(MensagemFila mensagemFila) {
        Span span = GlobalTracer.get().activeSpan();
        if (span != null) {
            span.setTag("email", mensagemFila.getEmailTimeResponsavel());
        }
    }
}




public void upload(MensagemFila mensagemFila) {
    Span span = GlobalTracer.get()
        .buildSpan("dataset.upload")
        .start();

    try (Scope scope = GlobalTracer.get().scopeManager().activate(span)) {
        // Chamada igual a antes
        ServiceExceptionAspect.adicionarObjetoLog(mensagemFila);

        logger.info("Iniciando upload...");
    } catch (Exception e) {
        span.setTag("error", true);
        logger.severe("Erro: " + e.getMessage());
    } finally {
        span.finish();
    }
}
