import { createElement } from 'lwc';
import Jx1Asset from 'c/jx1Asset';
import { FlowAttributeChangeEvent } from 'lightning/flowSupport';

describe('c-jx1-asset', () => {
    let element;

    beforeEach(() => {
        element = createElement('c-jx1-asset', {
            is: Jx1Asset
        });
        document.body.appendChild(element);
    });

    afterEach(() => {
        while (document.body.firstChild) {
            document.body.removeChild(document.body.firstChild);
        }
    });

    it('should set and get assets correctly', () => {
        const mockAssets = [{ id: 1, name: 'Asset 1' }];
        element.assets = mockAssets;
        expect(element.assets).toEqual(mockAssets);
    });

    it('should dispatch FlowAttributeChangeEvent with selected rows', () => {
        const mockSelectedRows = [{ id: 2, name: 'Asset 2' }];

        const handler = jest.fn();
        element.addEventListener('flowattributechange', handler);

        // Simula o evento vindo do datatable
        const event = {
            detail: {
                selectedRows: mockSelectedRows
            }
        };

        element.handlerRowSelection(event);

        expect(handler).toHaveBeenCalled();
        const eventDetail = handler.mock.calls[0][0].detail;
        expect(eventDetail.attributeName).toBe('assetswithcheck');
        expect(eventDetail.value).toEqual(mockSelectedRows);
    });
});
