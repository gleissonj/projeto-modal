private static List<AccountContactRelation__c> buscarContatos(List<Request> requisicoes) {
    Set<Id> ids = new Set<Id>();
    Set<String> nomes = new Set<String>();

    for (Request req : requisicoes) {
        if (req.accountId != null) ids.add(req.accountId);
        if (!String.isBlank(req.nomeContato)) nomes.add(req.nomeContato);
    }

    if (ids.isEmpty() && nomes.isEmpty()) return new List<AccountContactRelation__c>();

    List<AccountContactRelation__c> resultado = [SELECT 
        AccountId__r.Name,
        AccountId__r.Hu7IDExterno__c,
        Name,
        Email__c,
        CPF__c,
        Cargo__c,
        Perfil__c
        FROM AccountContactRelation__c
        WHERE
            (AccountId__c IN :ids OR :ids.isEmpty()) AND
            (
                :nomes.isEmpty() OR
                (
                    Name != null AND (
                        Name LIKE :('' + nomes[0] + '%') // apenas 1 nome para evitar concatenação insegura
                    )
                )
            )
    ];

    return resultado;
}
