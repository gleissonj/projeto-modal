import { Component } from '@angular/core';
import { FileService } from './file.service';

@Component({
  selector: 'app-file-download',
  template: `<button (click)="downloadCsv()">Download CSV</button>`
})
export class FileDownloadComponent {
  constructor(private fileService: FileService) {}

  downloadCsv() {
    this.fileService.downloadCsvFile().subscribe(response => {
      // Extract the filename from the Content-Disposition header
      const contentDisposition = response.headers.get('Content-Disposition');
      let filename = 'default.csv'; // Default name in case filename extraction fails

      if (contentDisposition) {
        const matches = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(contentDisposition);
        if (matches != null && matches[1]) {
          filename = matches[1].replace(/['"]/g, ''); // Remove any surrounding quotes
        }
      }

      // Create a URL for the Blob
      const url = window.URL.createObjectURL(response.body);

      // Create a link element to trigger the download
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      link.click();

      // Clean up and revoke the URL object
      window.URL.revokeObjectURL(url);
    });
  }
}
