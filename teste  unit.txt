using System;
using System.Net;
using System.Net.Http;
using System.Threading.Tasks;

public class Program
{
    public static async Task Main(string[] args)
    {
        // Define the proxy server address (without credentials)
        var proxy = new WebProxy("http://yourproxyserver:port")
        {
            UseDefaultCredentials = true  // Use system default credentials (if any)
        };

        // Configure HttpClientHandler to use the proxy
        var httpClientHandler = new HttpClientHandler
        {
            Proxy = proxy,
            UseProxy = true,
            UseDefaultCredentials = true,  // Enable this to allow system credentials if needed
            PreAuthenticate = true         // Pre-authenticate (even if no credentials are specified)
        };

        // Create an HttpClient with the configured handler
        var client = new HttpClient(httpClientHandler);

        try
        {
            // Send a GET request through the proxy
            HttpResponseMessage response = await client.GetAsync("http://example.com");
            response.EnsureSuccessStatusCode();

            // Read and display the response
            string content = await response.Content.ReadAsStringAsync();
            Console.WriteLine(content);
        }
        catch (HttpRequestException ex)
        {
            // Catch and display the error (if the request fails)
            Console.WriteLine($"Request error: {ex.Message}");
        }
    }
}
