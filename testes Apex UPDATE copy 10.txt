import { TestBed, ComponentFixture } from '@angular/core/testing';
import { YourComponent } from './your-component'; // ajuste o caminho conforme necessário
import { MsalService, MSAL_GUARD_CONFIG, MsalGuardConfiguration } from '@azure/msal-angular';
import { InteractionType, RedirectRequest } from '@azure/msal-browser';

describe('YourComponent - Método login()', () => {
  let component: YourComponent;
  let fixture: ComponentFixture<YourComponent>;

  // Mock do MsalService
  const msalServiceMock = {
    loginRedirect: jest.fn(),
    logoutRedirect: jest.fn() // caso use em outros métodos
  };

  // Configuração completa e tipada do MSAL_GUARD_CONFIG
  const guardConfig: MsalGuardConfiguration = {
    interactionType: InteractionType.Redirect,
    authRequest: {
      scopes: ['user.read'],
      extraQueryParameters: { prompt: 'select_account' }
    }
  };

  beforeEach(() => {
    TestBed.configureTestingModule({
      declarations: [YourComponent],
      providers: [
        { provide: MsalService, useValue: msalServiceMock },
        { provide: MSAL_GUARD_CONFIG, useValue: guardConfig }
      ]
    });

    fixture = TestBed.createComponent(YourComponent);
    component = fixture.componentInstance;
  });

  afterEach(() => {
    jest.clearAllMocks();
  });

  it('deve chamar loginRedirect com authRequest quando definido', () => {
    component.login();

    expect(msalServiceMock.loginRedirect).toHaveBeenCalledWith(
      expect.objectContaining({
        scopes: ['user.read'],
        extraQueryParameters: { prompt: 'select_account' }
      })
    );
  });

  it('deve chamar loginRedirect sem parâmetros quando authRequest não está definido', () => {
    // Simula authRequest undefined
    component.msalGuardConfig.authRequest = undefined;

    component.login();

    expect(msalServiceMock.loginRedirect).toHaveBeenCalledWith();
  });
});
