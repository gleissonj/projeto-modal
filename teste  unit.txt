import { ComponentFixture, TestBed } from '@angular/core/testing';
import { of, throwError } from 'rxjs';
import { YourComponent } from './your.component'; // Substitua pelo nome real do seu componente
import { MultipartUploadService } from './multipart-upload.service'; // Substitua pelo serviço correto

describe('YourComponent', () => {
  let component: YourComponent;
  let fixture: ComponentFixture<YourComponent>;
  let multipartUploadServiceMock: any;

  beforeEach(() => {
    // Mock do serviço
    multipartUploadServiceMock = {
      startStepFunction: jest.fn()
    };

    // Configuração do TestBed
    TestBed.configureTestingModule({
      declarations: [YourComponent],
      providers: [
        { provide: MultipartUploadService, useValue: multipartUploadServiceMock }
      ]
    });

    fixture = TestBed.createComponent(YourComponent);
    component = fixture.componentInstance;
  });

  it('deve exibir mensagem de erro se nameArn estiver vazio', () => {
    const showMessageSpy = jest.spyOn(component, 'showMessage');
    component.executadorStepFunction({ value: '' });
    expect(showMessageSpy).toHaveBeenCalledWith('voce precisa preencher o valor do campo', 'error');
  });

  it('deve chamar o serviço startStepFunction se nameArn não estiver vazio', () => {
    multipartUploadServiceMock.startStepFunction.mockReturnValue(of({ data: { status: 'success' } }));
    const showMessageSpy = jest.spyOn(component, 'showMessage');

    component.executadorStepFunction({ value: 'validArn' });
    
    expect(multipartUploadServiceMock.startStepFunction).toHaveBeenCalledWith('validArn');
    setTimeout(() => {
      expect(showMessageSpy).toHaveBeenCalledWith('success', 'error');
    }, 7000); // Testa o setTimeout
  });

  it('deve exibir mensagem de erro quando o serviço falha', () => {
    const errorMessage = 'Erro ao iniciar a função';
    multipartUploadServiceMock.startStepFunction.mockReturnValue(throwError({ error: { message: errorMessage } }));
    const showMessageSpy = jest.spyOn(component, 'showMessage');

    component.executadorStepFunction({ value: 'validArn' });
    
    expect(showMessageSpy).toHaveBeenCalledWith(errorMessage, 'error');
  });
});
